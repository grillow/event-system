#include <gtest/gtest.h>

#include "example.hpp"


TEST(Example, example) {
    std::shared_ptr<EventBus> bus = EventBus::Create();
    
    std::shared_ptr<PopulationStats> population(
		    std::make_shared<PopulationStats>());
    
    PopulationListenerHandler handler(bus);
    
   
    EXPECT_EQ(stats->GetPopulation(), 0);
    
    bus->Raise(std::make_unique<BirthEvent>("First"));
    
    EXPECT_EQ(stats->GetPopulation(), 1);
    
    bus->Raise(std::make_unique<BirthEvent>("Second"));
    
    EXPECT_EQ(stats->GetPopulation(), 2);
    
    bus->Raise(std::make_unique<DeathEvent>("Second"));
    
    EXPECT_EQ(stats->GetPopulation(), 1);
    
    bus->Raise(std::make_unique<BirthEvent>("Third"));
    
    EXPECT_EQ(stats->GetPopulation(), 2);
    
    bus->Raise(std::make_unique<DeathEvent>("First"));
    
    EXPECT_EQ(stats->GetPopulation(), 1);
    
    bus->Raise(std::make_unique<DeathEvent>("Third"));

    EXPECT_EQ(stats->GetPopulation(), 0);
}

